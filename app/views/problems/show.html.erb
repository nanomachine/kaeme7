<% provide(:title, "Details") %>
<div class="row">
  <aside class="span4">
    <section>

      <%= gmaps({
        "map_options" => {"auto_zoom" => false, "zoom" => 15 },
        "markers" => {"data" => @json }
        })
      %>      

      <h1>
      	<%= image_tag @problem.avatar.url(:medium) %>
      </h1>
      <ul>
     	<li>Report #<%= @problem.id %></li>
     	<li>Type: <%= @problem.get_prob_type %></li>
     	<li>User: <%= User.find(@problem.user_id).name %></li>
     	<li>Latitud: <%= @problem.latitude %></li>
     	<li>Longitud: <%= @problem.longitude %></li>
     	<li>Date Created: <%= @problem.created_at.strftime(" %b.%d %Y") %></li>
      <li>Description: <%= @problem.description %></li>
      <li>Comments:</li>

      <!--Preparing comments for disply-->
        <% @comments = @problem.comment_threads %>

      <!--This could be made a _comment to render-->
      <ul class="users">
        <% @comments.each do |comment| %>
          <% @user = User.find(comment.user_id) %>
          <table>
            <tr>
              <td colspan="2"><%= "--"+ @user.name + "-- on "+ comment.created_at.strftime(" %b.%d %Y") + " @ " + comment.created_at.strftime("%H:%M") %></td>

            </tr>
            <tr>
              <td colspan="2"><%= comment.body %></td>
              <!--implement comment threading functionality-->
            </tr>
            <tr>
              <td><%= link_to "Delete", delete_comment_from_problems_url(comment: comment), method: :delete, :confirm => 'Are you sure you wish to delete this comment?' %> </td>
            </tr>
          </table>
        <% end %>

      <li>Comment: 
      <%= form_tag "/problems/add_new_comment" do %>
        <%= hidden_field_tag "id", @problem.id %>
        <%= text_area :comment, :body, :size => "10x10" %>
        <%= submit_tag "Post Comment" %>
      </li>
      <% end %>


      </ul>     
    </section>
  </aside>
</div>
