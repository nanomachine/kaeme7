<% provide(:title, "Details") %>

<%= render 'layouts/sidebar' %>

<!--Bounding box heading with report id and title as well as tabbed view of photo and map -->
<div class="row-fluid fluid-box">

<!-- Photo box     -->
    <div class="box span6">
      <div class="box-header">
        <h2><i class="fa-icon-eye-open"></i><span class="break"></span>Report #<%=@problem.id%> - <%= @problem.title %></h2>
      </div>
      <div class="box-content">
            <%= image_tag @problem.avatar.url(:medium) %>
      </div>
    </div>


<!-- Map box      -->

    <div class="box span6">
      <div class="box-header">
        <h2><i class="fa-icon-globe"></i><span class="break"></span>Map</h2>
          <div class="box-icon">
            <%= link_to "#", class: "btn btn-success btn-setting" do %>
              <i class="icon-plus"></i> Add to list
            <% end %>
          </div>
      </div>
      <div class="box-content">
        <div class="row-fluid">
          <div class="span12">
            <%= gmaps({
              "map_options" => {"auto_zoom" => false, "zoom" => 15 },
              "markers" => {"data" => @json }
              })
            %>
          </div>
          <div class="box span12 ">
              <div class="box span4">
                  <h3>Address:</h3>
                    <p>
                      <%= @problem.address %>
                    </p>
                </div>

                <div class="box span4">
                  <h3>Latitude:</h3>
                    <p><%= @problem.latitude %></p>
                </div>

                <div class="box span4">
                  <h3>Longitude:</h3>
                    <p><%= @problem.longitude %></p>
                </div>
            </div>
          </div>
        </div>
    </div>
</div>


<
<div class="row-fluid fluid-box">

  <!--  Description Box     -->
      <div class="box span4 noMargin">
        <div class="box-header">
          <h2><i class="fa-icon-list"></i><span class="break"></span>Description</h2>
        </div>

        <div class="box-content">
          <div class="row-fluid">
            <div class="box span12">
              <p>
                <%= @problem.description %>
              </p>
            </div>
          </div>
        </div>
      </div>

  <!--  Details Box     -->
      <div class="box span4 noMargin">
        <div class="box-header">
          <h2><i class="fa-icon-list"></i><span class="break"></span>Details</h2>
        </div>
        <div class="box-content">
            <div class="row-fluid">

              <div class="box span6">
                <h3>Reporter:</h3>
                  <p><%= User.find(@problem.user_id).name %> <%= User.find(@problem.user_id).last_name %></p>
                <h3>Type:</h3>
                  <p><%= @problem.get_prob_type %></p>
                <h3>Status:</h3>
                  <p><%= @problem.get_prob_status %></p>
              </div>

              <div class="box span6">
                <h3>Priority:</h3>
                  <p><%= @problem.get_prob_priority %></p>
                <h3>Submitted on:</h3>
                  <p><%= @problem.created_at.strftime(" %b.%d %Y") %></p>
                <h3>Updated on:</h3>
                  <p><%= @problem.updated_at.strftime(" %b.%d %Y") %></p>
              </div>

            </div>
        </div>
      </div>

  <!-- Comment box    -->
      <div class="box span4 noMargin">
        <div class="box-header">
          <h2><i class="icon-comment"></i><span class="break"></span>Comments</h2>
        </div>
        <div class="box-content">
          <!--Preparing comments for dispaly-->
           <% @comments = @problem.comment_threads %>
          <!--This could be made a _comment partial to render-->
            <ul class="chat">
              <% @comments.each do |comment| %>
                <% @user = User.find(comment.user_id) %>

<!-- Aling all of current user's comments to the right for organization -->
                <% if current_user!= @user %>
                  <li class="left">
                    <img class="avatar" alt=<%= @user.name %> src=<%= @user.avatar.url(:medium) %>>
                    <span class="message"><span class="arrow"></span>
                      <span class="from"><%= @user.name + " " + @user.last_name %></span>
                      <span class="time"><%= comment.created_at.strftime(" %b.%d %Y at %T") %> </span>
                      <span class="text">
                        <%= comment.body %>
                      </span>
                    </span>  
                  </li>
                <% else %>
                  <li class="right">
                    <img class="avatar" src=<%= current_user.avatar.url(:medium) %>>
                    <span class="message"><span class="arrow"></span>
                      <span class="from"><%= current_user.name + " " + current_user.last_name %></span>
                      <span class="time"><%= comment.created_at.strftime(" %b.%d %Y at %T") %> </span>
                      <span class="text">
                        <%= comment.body %>
                      </span>
                    </span>  
                  </li>
                <% end %>
              <% end %>
            </ul>   

          </ul> 
            <div class="chat-form">
              <%= form_tag "/problems/add_new_comment" do %>
                <%= hidden_field_tag "id", @problem.id %>
                <%= text_area :comment, :body, :size => "10x10" %>
                <%= submit_tag "Post Comment" %>
              <% end %>
            </div> 
        </div>    
      </div>
    </div>

</div>
