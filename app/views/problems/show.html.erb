<% provide(:title, "Details") %>

<%= render 'layouts/sidebar' %>

<!--Bounding box heading with report id and title as well as tabbed view of photo and map -->
<div class="row-fluid fluid-box">

<!-- Photo box     -->
    <div class="box span6">
      <div class="box-header">
        <h2><i class="fa-icon-eye-open"></i><span class="break"></span>Report #<%=@problem.id%> - <%= @problem.title %></h2>
      </div>
      <div class="box-content">
            <%= image_tag @problem.avatar.url(:medium) %>
      </div>
    </div>


<!-- Map box      -->

    <div class="box span6">
      <div class="box-header">
        <h2><i class="fa-icon-globe"></i><span class="break"></span>Map</h2>
      </div>
      <div class="box-content">
        <div class="row-fluid">
          <div class="span12">
            <%= gmaps({
              "map_options" => {"auto_zoom" => false, "zoom" => 15 },
              "markers" => {"data" => @json }
              })
            %>
          </div>
          <div class="span12">
              <div class="box span4">
                  <h3>Address:</h3>
                    <p>
                      <%= @problem.address %>
                    </p>
                </div>

                <div class="box span4">
                  <h3>Latitude:</h3>
                    <p><%= @problem.latitude %></p>
                </div>

                <div class="box span4">
                  <h3>Longitude:</h3>
                    <p><%= @problem.longitude %></p>
                </div>
            </div>
          </div>
        </div>
    </div>
</div>

<hr>

<div class="row-fluid fluid-box">
  <!--  Details Box     -->
      <div class="box span6 noMargin">
        <div class="box-header">
          <h2><i class="fa-icon-list"></i><span class="break"></span>Details</h2>
          <div class="box-icon">
            <%= link_to "#", class: 'btn btn-success btn-setting' do %>
              <i class="icon-plus"></i> Add to list
            <% end %>
          </div>
        </div>
        <div class="box-content">
            <div class="row-fluid">

              <div class="box span4">

                <h3>Description:</h3>
                  <p>
                    <%= @problem.description %>
                </p>
              </div>

              <div class="box span4">
                <h3>Reporter:</h3>
                  <p><%= User.find(@problem.user_id).name %> <%= User.find(@problem.user_id).last_name %></p>
                <h3>Type:</h3>
                  <p><%= @problem.get_prob_type %></p>
                <h3>Status:</h3>
                  <p><%= @problem.get_prob_status %></p>
              </div>

              <div class="box span4">
                <h3>Priority:</h3>
                  <p><%= @problem.get_prob_priority %></p>
                <h3>Submitted on:</h3>
                  <p><%= @problem.created_at.strftime(" %b.%d %Y") %></p>
                <h3>Updated on:</h3>
                  <p><%= @problem.updated_at.strftime(" %b.%d %Y") %></p>
              </div>

            </div>
        </div>
      </div>

  <!-- Comment box    -->
      <div class="box span6">
        <div class="box-header">
          <h2><i class="icon-comment"></i><span class="break"></span>Comments</h2>
        </div>
        <div class="box-content">
          <!--Preparing comments for dispaly-->
           <% @comments = @problem.comment_threads %>
          <!--This could be made a _comment to render-->
          <ul class="users">
            <% @comments.each do |comment| %>
              <% @user = User.find(comment.user_id) %>
              <table>
                <tr>
                  <td colspan="2"><%= "--"+ @user.name + "-- on "+ comment.created_at.strftime(" %b.%d %Y") + " @ " + comment.created_at.strftime("%H:%M") %></td>

                </tr>
                <tr>
                  <td colspan="2"><%= comment.body %></td>
                  <!--implement comment threading functionality-->
                </tr>
                <tr>
                  <td><%= link_to "Delete", delete_comment_from_problems_url(comment: comment), method: :delete, :confirm => 'Are you sure you wish to delete this comment?' %> </td>
                </tr>
              </table>
            <% end %>
            <li>Comment: 
              <%= form_tag "/problems/add_new_comment" do %>
                <%= hidden_field_tag "id", @problem.id %>
                <%= text_area :comment, :body, :size => "10x10" %>
                <%= submit_tag "Post Comment" %>
            </li>
            <% end %>
          </ul> 
        </div>    
      </div>
    </div>

</div>


    <div class="modal hide fade" id="myModal">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">Ã—</button>
        <h3>Choose a list...</h3>
      </div>
      <div class="modal-body">
        <form class="form-horizontal">
          <fieldset>
            <div class="control-group">
              <label class="control-label" for="selectError">Lists</label>
              <div class="controls">
                <select id="selectError" data-rel="chosen">
                  <% if !current_user.lists.empty? %>
                    <% current_user.lists.each do |list| %>
                      <option><%= list.name %> <%=list.created_at.strftime(" %b.%d %Y") %></option>
                    <% end %>
                  <% end %>
                </select>
              </div>
            </div>   
          </fieldset>
        </form>
      </div>
      <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal">Close</a>
        <a href="#" class="btn btn-primary">Save changes</a>
      </div>
    </div>
